name: Fastlane

on:
  pull_request:
    branches: main

jobs:
  test:
    name: Test
    runs-on: macos-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v1
    - name: Install dependencies
      run: |
        pod deintegrate
        pod install --repo-update
      shell: bash
    - name: Bundle Install
      run: bundle install
    - name: Get the simulator up
      run: |
        fastlane run reset_simulator_contents
        xcrun instruments -w 'iPhone SE (2nd generation)' || sleep 15
    - name: Sanity tests
      run: bundle exec fastlane sanity_checks --verbose
